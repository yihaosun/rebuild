(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3aad0f85"],{"41b3":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"content_show"},[a("div",{staticClass:"choose_wrap"},[a("span",{staticClass:"date_title"},[t._v("报表时间：")]),t._v(" "),a("el-date-picker",{attrs:{size:"medium",type:"month",clearable:"",format:"yyyy-MM","value-format":"yyyy-MM"},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}}),t._v(" "),a("span",{staticClass:"down_wrap",on:{click:t.downTable}},[a("svg-icon",{attrs:{"icon-class":"down"}})],1),t._v(" "),a("span",{staticStyle:{"margin-left":"25px"}},[a("el-button",{attrs:{size:"medium",type:"danger"},on:{click:t.createTable}},[t._v("生成报表")])],1),t._v(" "),a("span",{staticStyle:{"margin-left":"10px"}},[a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.lookTable}},[t._v("查看")])],1),t._v(" "),t.showStatus?a("span",{staticStyle:{display:"inline-block","line-height":"37px","margin-left":"10px"}},[t._v("报表状态:"+t._s(t._f("getStatus")(t.status)))]):t._e()],1),t._v(" "),a("div",{staticClass:"date_wrap"},[t.showButton?a("div",{staticClass:"button_wrap"},[a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.changeEdit}},[t._v(t._s(t.showEdit?"保存":"编辑"))]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.commitTable}},[t._v("确认上报")])],1):t._e(),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.tableData,"row-key":"ID",border:"","show-summary":"","max-height":"700","summary-method":t.getSummaries,"tree-props":{children:"children",hasChildren:"hasChildren"},"header-cell-style":{"background-color":"#409eff",color:" #fff","border-bottom":"1px solid #fff","text-align":"center"}}},[a("el-table-column",{attrs:{prop:"B_ACC_CODE",label:"功能科目编码"}}),t._v(" "),a("el-table-column",{attrs:{prop:"B_ACC_NAME",label:"功能科目名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"MONEY",label:"累计金额",width:"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.showEdit?a("div",["N"==e.row.IS_LOWEST?a("el-input",{attrs:{disabled:!0},model:{value:e.row.MONEY,callback:function(a){t.$set(e.row,"MONEY",a)},expression:"scope.row.MONEY"}}):t._e(),t._v(" "),"N"!=e.row.IS_LOWEST?a("el-input",{attrs:{type:"number",clearable:""},on:{input:function(a){return t.handleClick(e.$index,e.row)}},model:{value:e.row.MONEY,callback:function(a){t.$set(e.row,"MONEY",a)},expression:"scope.row.MONEY"}}):t._e()],1):t._e(),t._v(" "),t.showEdit?t._e():a("div",{staticStyle:{"text-align":"right"}},[t._v(t._s(e.row.MONEY))])]}}])})],1)],1)])])},o=[],i=(a("c5f6"),a("ac6a"),a("28a5"),a("fb4b")),s=(a("d8b2"),a("5118")),r={data:function(){return{showButton:!1,loading:!1,showEdit:!1,tableData:[],date:"",status:"0",showStatus:!1,co_code:"",shortname:"",cpostguid:"",year:"",month:""}},filters:{getStatus:function(t){switch(t){case"1":return"未上报";case"3":return"已上报";case"5":return"已确认";default:break}}},methods:{downTable:function(){var t=this;this.year=this.date.split("-")[0],this.month=this.date.split("-")[1],Object(i["f"])({CO_CODE:this.co_code,FISCAL:this.year,FIS_PERD:this.month,STATUS:"2",CPOSTGUID:this.cpostguid,SHORTNAME:this.shortname}).then(function(e){var a=new Blob([e],{type:"application/vnd.ms-excel;charset=utf-8"}),n=document.createElement("a"),o=window.URL.createObjectURL(a);n.href=o,n.download="".concat(t.shortname+t.year+"年"+t.month+"月","一般公共预算支出功能科目月报.xls"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(o)}).catch(function(t){})},commitTable:function(){var t=this;this.loading=!0,Object(i["b"])({list:this.tableData,CO_CODE:this.co_code,FISCAL:this.year,FIS_PERD:this.month,STATUS:"3"}).then(function(e){t.loading=!1,t.status="3",t.showButton=!1}).catch(function(e){Object(s["setTimeout"])(function(){t.loading=!1},1500)})},createTable:function(){this.year=this.date.split("-")[0],this.month=this.date.split("-")[1],this.loading=!0,this.getDataSource(this.year,this.month,!0)},lookTable:function(){this.year=this.date.split("-")[0],this.month=this.date.split("-")[1],this.loading=!0,this.getDataSource(this.year,this.month,!1)},getSummaries:function(t){var e=this,a=t.columns,n=(t.data,[]);return a.forEach(function(t,a){if(0!==a)switch(t.property){case"MONEY":var o=0;e.tableData.map(function(t){null!=t.MONEY&&(o+=Number(t.MONEY))}),n[a]=o.toFixed(2)+"元";break;default:n[a]="--";break}else n[a]="总价"}),n},changeEdit:function(){this.showEdit&&(this.loading=!0,this.updateDataSource()),this.showEdit=!this.showEdit},getDataSource:function(t,e,a){var n=this;a?Object(i["i"])({CO_CODE:this.co_code,FISCAL:t,FIS_PERD:e}).then(function(t){n.loading=!1,n.tableData=t.dataList,n.status=t.dataList[0].SETID,n.showStatus=!0,"1"==n.status?n.showButton=!0:n.showButton=!1}).catch(function(t){Object(s["setTimeout"])(function(){n.loading=!1,n.showButton=!1,n.tableData=[],n.showStatus=!1},1500)}):Object(i["l"])({CO_CODE:this.co_code,FISCAL:t,FIS_PERD:e,STATUS:"1",CPOSTGUID:this.cpostguid}).then(function(t){n.loading=!1,n.tableData=t.dataList,n.status=t.dataList[0].SETID,n.showStatus=!0,"1"==n.status?n.showButton=!0:n.showButton=!1}).catch(function(t){Object(s["setTimeout"])(function(){n.loading=!1,n.showButton=!1,n.tableData=[],n.showStatus=!1},1500)})},updateDataSource:function(){var t=this;Object(i["p"])({list:this.tableData,STATUS:"1"}).then(function(e){e&&Object(s["setTimeout"])(function(){t.loading=!1},1e3)})},handleClick:function(t,e){var a=e.B_ACC_CODE,n=this.tableData.filter(function(t){if(a.substring(0,3)==t.B_ACC_CODE)return t});if(0!=n[0].children.length)if(a.length>6){var o=n[0].children.filter(function(t){if(a.substring(0,5)==t.B_ACC_CODE)return t}),i=0;o[0].children.map(function(t){null!=t.MONEY&&(i+=Number(t.MONEY))});o[0].MONEY=i.toFixed(2);var s=0;n[0].children.map(function(t){null!=t.MONEY&&(s+=Number(t.MONEY))}),n[0].MONEY=s.toFixed(2)}else{var r=0;n[0].children.map(function(t){null!=t.MONEY&&(r+=Number(t.MONEY))}),n[0].MONEY=r.toFixed(2)}},GetDateStr:function(){var t=new Date,e=t.getFullYear(),a=t.getMonth()+1;return e+"-"+a}},created:function(){this.co_code=localStorage.getItem("CO_CODE"),this.shortname=localStorage.getItem("SHORTNAME1"),this.cpostguid=localStorage.getItem("CPOSTGUID"),this.date=this.GetDateStr();var t=this.date.split("-");console.log(t),this.year=t[0],this.month=t[1]}},u=r,c=a("2877"),l=Object(c["a"])(u,n,o,!1,null,null,null);e["default"]=l.exports},fb4b:function(t,e,a){"use strict";a.d(e,"h",function(){return o}),a.d(e,"k",function(){return i}),a.d(e,"o",function(){return s}),a.d(e,"c",function(){return r}),a.d(e,"e",function(){return u}),a.d(e,"i",function(){return c}),a.d(e,"l",function(){return l}),a.d(e,"b",function(){return d}),a.d(e,"p",function(){return h}),a.d(e,"f",function(){return f}),a.d(e,"g",function(){return m}),a.d(e,"j",function(){return p}),a.d(e,"n",function(){return b}),a.d(e,"a",function(){return O}),a.d(e,"d",function(){return _}),a.d(e,"m",function(){return g});var n=a("b775");function o(t){return Object(n["a"])({url:"/JJKM/getlist",method:"get",params:t})}function i(t){return Object(n["a"])({url:"/JJKM/list",method:"post",data:t})}function s(t){return Object(n["a"])({url:"/JJKM/update",method:"post",data:t})}function r(t){return Object(n["a"])({url:"/JJKM/setid",method:"post",data:t})}function u(t){return Object(n["a"])({url:"/JJKM/list",method:"post",data:t,responseType:"blob"})}function c(t){return Object(n["a"])({url:"/GNKM/getlist",method:"get",params:t})}function l(t){return Object(n["a"])({url:"/GNKM/list",method:"post",data:t})}function d(t){return Object(n["a"])({url:"/GNKM/setid",method:"post",data:t})}function h(t){return Object(n["a"])({url:"/GNKM/update",method:"post",data:t})}function f(t){return Object(n["a"])({url:"/GNKM/list",method:"post",data:t,responseType:"blob"})}function m(t){return Object(n["a"])({url:"/JBZC/getlist",method:"get",params:t})}function p(t){return Object(n["a"])({url:"/JBZC/list",method:"post",data:t})}function b(t){return Object(n["a"])({url:"/JBZC/update",method:"post",data:t})}function O(t){return Object(n["a"])({url:"/JBZC/setid",method:"post",data:t})}function _(t){return Object(n["a"])({url:"/JBZC/list",method:"post",data:t,responseType:"blob"})}function g(t){return Object(n["a"])({url:"report/outgoings/page",method:"post",data:t})}}}]);